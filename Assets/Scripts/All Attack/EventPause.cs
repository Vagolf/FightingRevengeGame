using UnityEngine;
using System.Collections;

public class EventPause : MonoBehaviour
{
    public Player player; // ????????????????? Player
    public Animator animator;   // Animator ??????????
    public string animationName = "Kaisa-ltimate"; // ???? animation
    public float freezeDuration = 3f; // ??????????????
    public bool autoTriggerOnStart = false; // ??????????? Start ???????

    private bool hasPlayed = false;

    private void Start()
    {
        if (autoTriggerOnStart)
        {
            TriggerEventAnimation();
        }
    }

    public void TriggerEventAnimation()
    {
        if (!hasPlayed)
            StartCoroutine(PlayEventAnimation());
    }

    private IEnumerator PlayEventAnimation()
    {
        hasPlayed = true;

        // ???? Animator ??????? animation ?????? Unscaled Time
        animator.updateMode = AnimatorUpdateMode.UnscaledTime;
        animator.Play(animationName, 0, 0);

        // ???? animation ?????? 1 ???
        AnimatorStateInfo state = animator.GetCurrentAnimatorStateInfo(0);
        while (state.normalizedTime < 1.0f)
        {
            yield return null;
            state = animator.GetCurrentAnimatorStateInfo(0);
        }

        // Freeze pose ????????
        animator.speed = 0f;

        // ???????? player.isUltimating ?????? false ?????????????
        while (player.isUltimating)
        {
            yield return null;
        }

        // ??????????????
        animator.speed = 1f;
        // ????????? ??????????????
        enabled = false;
    }
}